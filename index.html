<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Birthdate Input</title>
    <link rel="stylesheet" href="./index.css">
</head>
<body>
    
    <div class="main">
        <div class="birthdate-input-main">
            <div class="birthdate-icon"><img class="birthday-logo"></div>
            <ul class="birthdate-inputs">
                <li class="day-input"><input type="text" name="birthdate-day" class="birthdate-input" id="birthdate-day" placeholder="dd" maxlength="2"></li>
                <li class="separator">/</li>
                <li class="month-input"><input type="text" name="birthdate-month" class="birthdate-input"  id="birthdate-month" placeholder="mm" maxlength="2"></li>
                <li class="separator">/</li>
                <li class="year-input"><input type="text" name="birthdate-year" class="birthdate-input"  id="birthdate-year" placeholder="yyyy" maxlength="4"></li>
            </ul>
            <ul class="errors">
                <li class="error">Day is not valid!</li>
                <li class="error">Month is not valid!</li>
                <li class="error">Not born yet!</li>
            </ul>
        </div>
    </div>



<script>

    let dayValue = '', monthValue = '', yearValue = '';
    let isErrorYear = false, isErrorDay = false, isErrorMonth = false;
    const errorMessages = document.querySelectorAll('.error');
    document.querySelector('.birthday-logo').src="./icons/calendar.png";

    function inputBorderColorFocusin(){document.querySelector('.birthdate-input-main').style.borderColor = isErrorYear || isErrorDay || isErrorMonth ? 'red' : '#0077ff';}
    function inputBorderColorFocusout(){document.querySelector('.birthdate-input-main').style.borderColor = isErrorYear || isErrorDay || isErrorMonth ? 'red' : 'gray';}
     
    const input = document.querySelectorAll('.birthdate-input');
    for(i=0; i<3; i++){
        input[i].setAttribute('size',input[i].getAttribute('placeholder').length*0.9);
        input[i].addEventListener('focusin',inputBorderColorFocusin);
    }

    var today = new Date();
    var currentDay = today.getDate();
    var currentMonth = today.getMonth()+1;
    var currentYear = today.getFullYear();

    function isBorn(day,month,year)
    {
        if(year>currentYear)
            return false;
        if(day=='' || year=='' || month=='')
            return true;
        if(year == currentYear && month>currentMonth)
            return false;
        else if(year == currentYear && month == currentMonth && day>currentDay)
            return false;
        return true;
    }

    function yearIcon(year)
    {
        let age = currentYear - yearValue;

        if(yearValue!='' &&   age>=150)
            document.querySelector('.birthday-logo').src="./icons/rip.png";
        else if(age<150 && age>60)
            document.querySelector('.birthday-logo').src="./icons/old.png";
        else if(age>=0 && age<=10)
            document.querySelector('.birthday-logo').src="./icons/baby.png";
        else if(age>=11 && age<=60)
            document.querySelector('.birthday-logo').src="./icons/teen.png";
    }

    function monthIcon(day,month)
    {
        if(day=='' || month=='')
            return true;
        if((day>=21 && month==3)||(day<20 && month==4))
            document.querySelector('.birthday-logo').src="./icons/aries.png";
        else if((day>=20 && month==4)||(day<21 && month==5))
            document.querySelector('.birthday-logo').src="./icons/taurus.png";
        else if((day>=21 && month==5)||(day<21 && month==6))
            document.querySelector('.birthday-logo').src="./icons/gemini.png";
        else if((day>=21 && month==6)||(day<23 && month==7))
            document.querySelector('.birthday-logo').src="./icons/cancer.png";
        else if((day>=23 && month==7)||(day<23 && month==8))
            document.querySelector('.birthday-logo').src="./icons/leo.png";
        else if((day>=23 && month==8)||(day<23 && month==9))
            document.querySelector('.birthday-logo').src="./icons/virgo.png";
        else if((day>=23 && month==9)||(day<23 && month==10))
            document.querySelector('.birthday-logo').src="./icons/libra.png";
        else if((day>=23 && month==10)||(day<22 && month==11))
            document.querySelector('.birthday-logo').src="./icons/scorpio.png";
        else if((day>=22 && month==11)||(day<22 && month==12))
            document.querySelector('.birthday-logo').src="./icons/sagittarius.png";
        else if((day>=22 && month==12)||(day<20 && month==1))
            document.querySelector('.birthday-logo').src="./icons/capricorn.png";
        else if((day>=20 && month==1)||(day<19 && month==2))
            document.querySelector('.birthday-logo').src="./icons/aquarius.png";
        else if((day>=19 && month==2)||(day<20 && month==3))
            document.querySelector('.birthday-logo').src="./icons/pisces.png";
    }

    function isValidDay(day,month,year)
    {
        if(day=='')
            return true;
        if(day>31)
            return false;
        if(day==31 && month in [2,4,6,9,11])
            return false;
        if(day>29 && month == 2)
            return false;
        if(day==29 && month == 2 && year!='')
        {
            let isBisect = false;
            if((year % 4 == 0) && (year % 100 != 0))
                isBisect = true;
            if(year % 400 == 0)
                isBisect = true;

            if(!isBisect)
                return false;
        }
        return true;
    }

    function isValidMonth(month)
    { return (month<13 && month>0) || month=='' ?  true :  false; }
    
    function defaultIcon()
    { document.querySelector('.birthday-logo').src="./icons/calendar.png"; }

    function computeErrorsAndIcons(dayValue,monthValue,yearValue)
    {
        if(!isBorn(dayValue,monthValue,yearValue) || !isValidDay(dayValue,monthValue,yearValue) || !isValidMonth(monthValue))
        {
            if(!isBorn(dayValue,monthValue,yearValue))
                {
                    isErrorYear = true;
                    errorMessages[2].style.display='block';
                }
            else
                errorMessages[2].style.display='none';
            if(!isValidDay(dayValue,monthValue,yearValue))
                {
                    isErrorDay = true;
                    errorMessages[0].style.display='block';
                }
            else
                errorMessages[0].style.display='none';
            if(!isValidMonth(monthValue))
                {
                    isErrorMonth = true;
                    errorMessages[1].style.display='block';
                }
            else
                errorMessages[1].style.display='none';
            document.querySelector('.birthday-logo').src="./icons/error.png";
        }
        else
        {
            isErrorYear = false;
            isErrorDay = false;
            isErrorMonth = false;
            defaultIcon();
            monthIcon(dayValue,monthValue);
            yearIcon(yearValue);
        }
    }

    input[0].addEventListener('focusout',function(){
        dayValue = input[0].value;
        if(String(dayValue).length<2 && String(dayValue).length>0)
            input[0].value = '0'+ String(dayValue);
        computeErrorsAndIcons(dayValue,monthValue,yearValue);
        inputBorderColorFocusout();
    });
    input[0].addEventListener('click',function(){
        errorMessages[0].style.display = 'none';
        isErrorDay = false;
        dayValue = '';
        input[0].value = '';
    });

    input[1].addEventListener('focusout',function(){
        monthValue = input[1].value;
        if(String(monthValue).length<2 && String(monthValue).length>0)
            input[1].value = '0'+ String(monthValue);
        computeErrorsAndIcons(dayValue,monthValue,yearValue);
        inputBorderColorFocusout();
    });
    input[1].addEventListener('click',function(){
        errorMessages[1].style.display = 'none';
        isErrorMonth = false;
        monthValue = '';
        input[1].value = '';
    });

    input[2].addEventListener('focusout',function(){
        yearValue = input[2].value;
        computeErrorsAndIcons(dayValue,monthValue,yearValue);
        inputBorderColorFocusout();
    });
    input[2].addEventListener('click',function(){
        errorMessages[2].style.display = 'none';
        isErrorYear = false;
        yearValue = '';
        input[2].value = '';
    });


</script>
</body>
</html>